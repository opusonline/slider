/*!
 * jquery slider plugin
 * with tooltip and progress supporting touch devices
 * Copyright 2011, Stefan Benicke (opusonline.at)
 * Dual licensed under the MIT or GPL Version 3 licenses.
 */
(function(f){f.extend(f.expr[":"],{range:function(A){return"range"==f(A).attr("type")}});var j={min:0,max:100,step:1,disabled:false,tooltip:true,progress:true,tooltipTransform:function(A){return A},onChange:function(A){},onEnd:function(A){}},v,a,q,r,h="mousedown.",d="mouseup.",m="mousemove.",i="slider",y=function(){return"ontouchend" in document},k=function(){if(!y()){return}h="touchstart.";d="touchend.";m="touchmove."},w=function(B){s(B);v=f(this).data("handle").focus();var C=v.data();if(C.disabled){v=null;return}q=C.slider_left;var A=B.originalEvent&&B.originalEvent.touches?B.originalEvent.touches[0]:B;a=parseFloat(A.pageX);var D=a-q;t(v,D,C.options.onEnd);v=null},e=function(B){s(B);v=f(this).focus();var C=v.data(),A=B.originalEvent&&B.originalEvent.touches?B.originalEvent.touches[0]:B;if(C.disabled){v=null;return}a=parseFloat(A.pageX);q=C.slider_left;if(B.originalEvent&&B.originalEvent.touches){C.tooltip.show()}r=setInterval(p,20)},l=function(B){if(!v){return}B.preventDefault();var A=B.originalEvent&&B.originalEvent.touches?B.originalEvent.touches[0]:B;a=parseFloat(A.pageX)},x=function(A){if(!r||!v){return}clearInterval(r);r=null;var B=v.data();if(!B.over){B.tooltip.hide()}if(!B.active){v.removeClass("active")}if(A.originalEvent&&A.originalEvent.touches){B.tooltip.hide()}B.options.onEnd.call(B.element,B.value);v=null},p=function(){if(!r){return}var A=a-q;t(v,A)},t=function(D,A,F){var C=D.data(),E=Math.round(A/C.step_width),B=E*C.step+C.min;A=E*C.step_width;if(B==C.value){return}n(D,A);g(D,B,F)},n=function(C,A){var B=C.data();if(A>B.slider_width){A=B.slider_width}if(A<0){A=0}C.css("left",A);if(B.options.progress){B.progress.width(A)}B.tooltip.css("left",A)},g=function(D,C,E){var B=D.data(),A=B.value;if(C>B.max){C=B.max}if(C<B.min){C=B.min}if(C==A){return}D.data("value",C);B.tooltip.html(B.options.tooltipTransform(C));B.options.onChange.call(B.element,C);if(E){E.call(B.element,C)}},o=function(H,E,B,F,D){var C=B-E,G=parseFloat(D/(C/F)),A=(H-E)*G/F;return{position:A,step_width:G}},b=function(B){var A=B.keyCode;if(A==39){s(B);z(f(this).data("handle"),1)}if(A==37){s(B);z(f(this).data("handle"),-1)}if(A==36){s(B);var D=f(this).data("handle");var C=D.data();c(D,C.min)}if(A==35){s(B);var D=f(this).data("handle");var C=D.data();c(D,C.max)}},z=function(D,C){var B=D.data();var A=B.value+C*B.step;c(D,A)},c=function(D,C){var B=D.data();if(B.disabled){return}if(B.options.tooltip){clearTimeout(B.timer);B.timer=setTimeout(function(){B.tooltip.fadeOut()},1500);B.tooltip.stop(true,true).fadeIn("fast")}var A=o(C,B.min,B.max,B.step,B.slider_width);n(D,A.position);g(D,C,B.options.onEnd)},u=function(B,A){B.data("disabled",A);if(A){B.attr("tabindex",-1).data("root").addClass("disabled")}else{B.attr("tabindex",0).data("root").removeClass("disabled")}},s=function(A){A.preventDefault();A.stopPropagation();A.cancelBubble=true;A.returnValue=false};k();f(document).bind(m+i,l).bind(d+i,x);f.fn.slider=function(A){A=f.extend({},j,A);return this.each(function(){if(f(this).data("slider")){return}var H=function(){B.data("over",true);if(v){return}if(A.tooltip){O.fadeIn("fast")}},U=function(){B.data("over",false);if(v){return}O.hide()},G=function(){B.addClass("active").data("active",true)},I=function(){B.data("active",false);if(v){return}B.removeClass("active")},K=f(this).hide(),S=f('<span class="slider"/>').bind(h+i,w).bind("mouseenter."+i,H).bind("mouseleave."+i,U).bind("keydown."+i,b),C=f('<span class="slider-bar"/>'),L=f('<span class="slider-progress"/>'),B=f('<span class="slider-handle" tabindex="0"/>').bind(h+i,e).bind("mouseenter."+i,G).bind("mouseleave."+i,I),O=f('<span class="slider-tooltip" style="display:none"/>'),T=K.attr("min"),N=T!=undefined?parseInt(T):A.min,E=K.attr("max"),P=E!=undefined?parseInt(E):A.max,Q=K.attr("step"),F=Q!=undefined?parseInt(Q):A.step,X=K.attr("value"),M=X!=""?parseInt(X):parseInt(P/2+N),J=K.attr("disabled"),D=J!=undefined?J:A.disabled;S.data({handle:B}).append(C,L,B,O).insertAfter(K.data("slider",B));var R=C.width(),W=C.offset().left,V=o(M,N,P,F,R);B.data({element:K,root:S,progress:L,tooltip:O,slider_left:W,slider_width:R,step_width:V.step_width,value:"n/a",max:P,min:N,step:F,disabled:D,options:A,timer:null});n(B,V.position);g(B,M);u(B,D)})};f.fn.sliderAttr=function(){var G=this.length?f(this[0]):f(this);var E=G.data("slider");if(!E){return}var H=arguments[0];var D=E.data();if(H==undefined){return{value:D.value,min:D.min,max:D.max,step:D.step,disabled:D.disabled}}if(typeof H=="object"){for(var A in H){G.sliderAttr(A,H[A])}return G}var A=H;if(typeof A!="string"){return}var F;var B="get";if(arguments[1]!=undefined){B="set";F=arguments[1];if(typeof F=="number"){F=parseInt(F)}}var C={value:{get:function(){return D.value},set:function(){var J=o(F,D.min,D.max,D.step,D.slider_width);n(E,J.position);g(E,F,D.options.onEnd)}},min:{get:function(){return D.min},set:function(){var J=o(D.value,F,D.max,D.step,D.slider_width);E.data({min:F,step_width:J.step_width});n(E,J.position)}},max:{get:function(){return D.max},set:function(){var J=o(D.value,D.min,F,D.step,D.slider_width);E.data({max:F,step_width:J.step_width});n(E,J.position)}},step:{get:function(){return D.step},set:function(){var J=o(D.value,D.min,D.max,F,D.slider_width);E.data({step:F,step_width:J.step_width})}},disabled:{get:function(){return D.disabled},set:function(){u(E,F)}}};if(C[A]==undefined){return}var I=C[A][B]();return B=="get"?I:G};f.fn.sliderMove=function(){var B=this.length?f(this[0]):f(this);var D=B.data("slider");if(!D){return}var A=arguments[0];if(A==undefined){return}var C=D.data();var E={up:function(){z(D,1)},down:function(){z(D,-1)},min:function(){c(D,C.min)},max:function(){c(D,C.max)}};if(E[A]==undefined){return}E[A]();return B}})(jQuery);