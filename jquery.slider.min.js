/*!
 * jquery slider plugin
 * with tooltip and progress supporting touch devices
 * Copyright 2011, Stefan Benicke (opusonline.at)
 * Dual licensed under the MIT or GPL Version 3 licenses.
 */
(function(g){g.extend(g.expr[":"],{range:function(C){return"range"==g(C).attr("type")}});var k={min:0,max:100,step:1,status:false,tooltip:true,progress:true,disabled:false,tooltipTransform:function(C){return C},onStart:function(C){},onChange:function(C){},onChanged:function(C){}},y,a,s,t,p="ontouchend" in document,i="mousedown.",e="mouseup.",n="mousemove.",j="slider",l=function(){if(!p){return}i="touchstart.";e="touchend.";n="touchmove."},z=function(D){u(D);y=g(this).data("handle").focus();var E=y.data();if(E.disabled){y=null;return}E.options.onStart.call(E.element,E.value);s=E.slider_left;var C=D.originalEvent&&D.originalEvent.touches?D.originalEvent.touches[0]:D;a=parseFloat(C.pageX);var F=a-s;v(y,F);E.options.onChanged.call(E.element,E.value);y=null},f=function(D){u(D);y=g(this).focus();var E=y.data(),C=D.originalEvent&&D.originalEvent.touches?D.originalEvent.touches[0]:D;if(E.disabled){y=null;return}E.options.onStart.call(E.element,E.value);a=parseFloat(C.pageX);s=E.slider_left;if(D.originalEvent&&D.originalEvent.touches){E.tooltip.show()}t=setInterval(r,20)},m=function(D){if(!y){return}D.preventDefault();var C=D.originalEvent&&D.originalEvent.touches?D.originalEvent.touches[0]:D;a=parseFloat(C.pageX)},A=function(C){if(!t||!y){return}clearInterval(t);t=null;var D=y.data();if(!D.over){D.tooltip.hide()}if(!D.active){y.removeClass("active")}if(C.originalEvent&&C.originalEvent.touches){D.tooltip.hide()}D.options.onChanged.call(D.element,D.value);y=null},r=function(){if(!t){return}var C=a-s;v(y,C)},v=function(F,C){var E=F.data(),G=Math.round(C/E.step_width),D=G*E.step+E.min;C=G*E.step_width;if(D==E.value){return}o(F,C);h(F,D)},o=function(E,C){var D=E.data();if(C>D.slider_width){C=D.slider_width}if(C<0){C=0}E.css("left",C);if(D.options.progress){D.progress.width(C)}D.tooltip.css("left",C)},h=function(F,E){var D=F.data(),C=D.value;if(E>D.max){E=D.max}if(E<D.min){E=D.min}if(E==C){return}F.data("value",E);D.tooltip.html(D.options.tooltipTransform(E));D.options.onChange.call(D.element,E)},x=function(F,E){var D=F.data();if(E<D.min){E=D.min}if(E>D.max){E=D.max}F.data("status_value",E);var C=q(E,D.min,D.max,D.step,D.slider_width);D.status.width(C.position)},q=function(J,G,D,H,F){var E=D-G,I=parseFloat(F/(E/H)),C=(J-G)*I/H;return{position:C,step_width:I}},c=function(D){var C=D.keyCode;if(!(C==39||C==37||C==36||C==35)){return}u(D);y=g(this).data("handle");var E=y.data();E.options.onStart.call(E.element,E.value);if(C==39){B(y)}if(C==37){b(y)}if(C==36){d(y,E.min)}if(C==35){d(y,E.max)}E.options.onChanged.call(E.element,E.value);y=null},B=function(E){var D=E.data();var C=D.value+D.step;d(E,C)},b=function(E){var D=E.data();var C=(Math.ceil(D.value/D.step)-1)*D.step;d(E,C)},d=function(F,E){var D=F.data();if(D.disabled){return}if(D.options.tooltip){clearTimeout(D.timer);D.timer=setTimeout(function(){D.tooltip.fadeOut()},1500);D.tooltip.stop(true,true).fadeIn("fast")}var C=q(E,D.min,D.max,D.step,D.slider_width);o(F,C.position);h(F,E)},w=function(D,C){D.data("disabled",C);if(C){D.attr("tabindex",-1).data("root").addClass("disabled")}else{D.attr("tabindex",0).data("root").removeClass("disabled")}},u=function(C){C.preventDefault();C.stopPropagation();C.cancelBubble=true;C.returnValue=false};l();g(document).bind(n+j,m).bind(e+j,A);g.fn.slider=function(C){C=g.extend({},k,C);return this.each(function(){if(g(this).data("slider")){return}var L=function(){D.data("over",true);if(y){return}if(C.tooltip){V.fadeIn("fast")}},ad=function(){D.data("over",false);if(y){return}V.hide()},K=function(){D.addClass("active").data("active",true)},M=function(){D.data("active",false);if(y){return}D.removeClass("active")},J=function(ah){ah.preventDefault();b(D)},R=function(ah){ah.preventDefault();B(D)},P=g(this).hide(),ab=g('<span class="slider"/>').bind(i+j,z).bind("mouseenter."+j,L).bind("mouseleave."+j,ad).bind("keydown."+j,c),F=g('<span class="slider-bar"/>'),aa=g('<span class="slider-status"/>'),Q=g('<span class="slider-progress"/>'),D=g('<span class="slider-handle" tabindex="0"/>').bind(i+j,f).bind("mouseenter."+j,K).bind("mouseleave."+j,M),V=g('<span class="slider-tooltip" style="display:none"/>'),N=g('<span class="slider-down"/>').bind(i+j,J),E=g('<span class="slider-up"/>').bind(i+j,R),ac=P.attr("min"),U=ac!=undefined?parseInt(ac):parseInt(C.min),H=P.attr("max"),X=H!=undefined?parseInt(H):parseInt(C.max),W=P.attr("step"),I=W!=undefined?parseInt(W):parseInt(C.step),ag=P.attr("value"),Y=typeof C.value=="number"?parseInt(C.value):parseInt(X/2+U),S=ag!=undefined?parseInt(ag):Y,O=P.attr("disabled"),G=O!=undefined?O:C.disabled,T=C.status!=false?parseInt(C.status):U;ab.data({handle:D}).append(F,aa,Q,D,V).insertAfter(P.data("slider",D));if(p){ab.before(N).after(E)}var Z=F.width(),af=F.offset().left,ae=q(S,U,X,I,Z);D.data({element:P,root:ab,status:aa,progress:Q,tooltip:V,slider_left:af,slider_width:Z,step_width:ae.step_width,value:"n/a",max:X,min:U,step:I,disabled:G,status_value:T,options:C,timer:null});o(D,ae.position);h(D,S);w(D,G);x(D,T)})};g.fn.sliderAttr=function(){var I=this.length?g(this[0]):g(this);var G=I.data("slider");if(!G){return}var J=arguments[0];var F=G.data();if(J==undefined){return{value:F.value,min:F.min,max:F.max,step:F.step,disabled:F.disabled,status:F.status_value}}if(typeof J=="object"){for(var C in J){I.sliderAttr(C,J[C])}return I}var C=J;if(typeof C!="string"){return}var H;var D="get";if(arguments[1]!=undefined){D="set";H=arguments[1];if(typeof H=="number"){H=parseInt(H)}}var E={value:{get:function(){return F.value},set:function(){if(y){return}var L=q(H,F.min,F.max,F.step,F.slider_width);o(G,L.position);h(G,H)}},min:{get:function(){return F.min},set:function(){var L=q(F.value,H,F.max,F.step,F.slider_width);G.data({min:H,step_width:L.step_width});o(G,L.position)}},max:{get:function(){return F.max},set:function(){var L=q(F.value,F.min,H,F.step,F.slider_width);G.data({max:H,step_width:L.step_width});o(G,L.position)}},step:{get:function(){return F.step},set:function(){var L=q(F.value,F.min,F.max,H,F.slider_width);G.data({step:H,step_width:L.step_width})}},disabled:{get:function(){return F.disabled},set:function(){w(G,H)}},status:{get:function(){return F.status_value},set:function(){x(G,H)}}};if(E[C]==undefined){return}var K=E[C][D]();return D=="get"?K:I};g.fn.sliderMove=function(){var D=this.length?g(this[0]):g(this);var F=D.data("slider");if(!F){return}var C=arguments[0];if(C==undefined){return}var E=F.data();var G={up:function(){B(F)},down:function(){b(F)},min:function(){d(F,E.min)},max:function(){d(F,E.max)}};if(G[C]==undefined){return}G[C]();return D}})(jQuery);