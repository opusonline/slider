/*!
 * jquery slider plugin
 * with tooltip and progress supporting touch devices
 * Copyright 2011, Stefan Benicke (opusonline.at)
 * Dual licensed under the MIT or GPL Version 3 licenses.
 */
(function(f){f.extend(f.expr[":"],{range:function(B){return"range"==f(B).attr("type")}});var j={min:0,max:100,step:1,status:false,tooltip:true,progress:true,disabled:false,tooltipTransform:function(B){return B},onStart:function(B){},onChange:function(B){},onChanged:function(B){}},x,a,r,s,o="ontouchend" in document,h="mousedown.",d="mouseup.",m="mousemove.",i="slider",k=function(){if(!o){return}h="touchstart.";d="touchend.";m="touchmove."},y=function(C){t(C);x=f(this).data("handle").focus();var D=x.data();if(D.disabled){x=null;return}D.options.onStart.call(D.element,D.value);r=D.slider_left;var B=C.originalEvent&&C.originalEvent.touches?C.originalEvent.touches[0]:C;a=parseFloat(B.pageX);var E=a-r;u(x,E);D.options.onChanged.call(D.element,D.value);x=null},e=function(C){t(C);x=f(this).focus();var D=x.data(),B=C.originalEvent&&C.originalEvent.touches?C.originalEvent.touches[0]:C;if(D.disabled){x=null;return}D.options.onStart.call(D.element,D.value);a=parseFloat(B.pageX);r=D.slider_left;if(C.originalEvent&&C.originalEvent.touches){D.tooltip.show()}s=setInterval(q,20)},l=function(C){if(!x){return}C.preventDefault();var B=C.originalEvent&&C.originalEvent.touches?C.originalEvent.touches[0]:C;a=parseFloat(B.pageX)},z=function(B){if(!s||!x){return}clearInterval(s);s=null;var C=x.data();if(!C.over){C.tooltip.hide()}if(!C.active){x.removeClass("active")}if(B.originalEvent&&B.originalEvent.touches){C.tooltip.hide()}C.options.onChanged.call(C.element,C.value);x=null},q=function(){if(!s){return}var B=a-r;u(x,B)},u=function(E,B){var D=E.data(),F=Math.round(B/D.step_width),C=F*D.step+D.min;B=F*D.step_width;if(C==D.value){return}n(E,B);g(E,C)},n=function(D,B){var C=D.data();if(B>C.slider_width){B=C.slider_width}if(B<0){B=0}D.css("left",B);if(C.options.progress){C.progress.width(B)}C.tooltip.css("left",B)},g=function(E,D){var C=E.data(),B=C.value;if(D>C.max){D=C.max}if(D<C.min){D=C.min}if(D==B){return}E.data("value",D);C.tooltip.html(C.options.tooltipTransform(D));C.options.onChange.call(C.element,D)},w=function(E,D){var C=E.data();if(D<C.min){D=C.min}if(D>C.max){D=C.max}E.data("status_value",D);var B=p(D,C.min,C.max,C.step,C.slider_width);C.status.width(B.position)},p=function(I,F,C,G,E){var D=C-F,H=parseFloat(E/(D/G)),B=(I-F)*H/G;return{position:B,step_width:H}},b=function(C){var B=C.keyCode;if(!(B==39||B==37||B==36||B==35)){return}t(C);x=f(this).data("handle");var D=x.data();D.options.onStart.call(D.element,D.value);if(B==39){A(x,1)}if(B==37){A(x,-1)}if(B==36){c(x,D.min)}if(B==35){c(x,D.max)}D.options.onChanged.call(D.element,D.value);x=null},A=function(E,D){var C=E.data();var B=C.value+D*C.step;c(E,B)},c=function(E,D){var C=E.data();if(C.disabled){return}if(C.options.tooltip){clearTimeout(C.timer);C.timer=setTimeout(function(){C.tooltip.fadeOut()},1500);C.tooltip.stop(true,true).fadeIn("fast")}var B=p(D,C.min,C.max,C.step,C.slider_width);n(E,B.position);g(E,D)},v=function(C,B){C.data("disabled",B);if(B){C.attr("tabindex",-1).data("root").addClass("disabled")}else{C.attr("tabindex",0).data("root").removeClass("disabled")}},t=function(B){B.preventDefault();B.stopPropagation();B.cancelBubble=true;B.returnValue=false};k();f(document).bind(m+i,l).bind(d+i,z);f.fn.slider=function(B){B=f.extend({},j,B);return this.each(function(){if(f(this).data("slider")){return}var J=function(){C.data("over",true);if(x){return}if(B.tooltip){S.fadeIn("fast")}},aa=function(){C.data("over",false);if(x){return}S.hide()},I=function(){C.addClass("active").data("active",true)},K=function(){C.data("active",false);if(x){return}C.removeClass("active")},N=f(this).hide(),Y=f('<span class="slider"/>').bind(h+i,y).bind("mouseenter."+i,J).bind("mouseleave."+i,aa).bind("keydown."+i,b),E=f('<span class="slider-bar"/>'),X=f('<span class="slider-status"/>'),O=f('<span class="slider-progress"/>'),C=f('<span class="slider-handle" tabindex="0"/>').bind(h+i,e).bind("mouseenter."+i,I).bind("mouseleave."+i,K),S=f('<span class="slider-tooltip" style="display:none"/>'),L=f('<span class="slider-down"/>').bind(h+i,function(){A(C,-1)}),D=f('<span class="slider-up"/>').bind(h+i,function(){A(C,1)}),Z=N.attr("min"),R=Z!=undefined?parseInt(Z):parseInt(B.min),G=N.attr("max"),U=G!=undefined?parseInt(G):parseInt(B.max),T=N.attr("step"),H=T!=undefined?parseInt(T):parseInt(B.step),ad=N.attr("value"),V=typeof B.value=="number"?parseInt(B.value):parseInt(U/2+R),P=ad!=undefined?parseInt(ad):V,M=N.attr("disabled"),F=M!=undefined?M:B.disabled,Q=B.status!=false?parseInt(B.status):R;Y.data({handle:C}).append(E,X,O,C,S).insertAfter(N.data("slider",C));if(o){Y.before(L).after(D)}var W=E.width(),ac=E.offset().left,ab=p(P,R,U,H,W);C.data({element:N,root:Y,status:X,progress:O,tooltip:S,slider_left:ac,slider_width:W,step_width:ab.step_width,value:"n/a",max:U,min:R,step:H,disabled:F,status_value:Q,options:B,timer:null});n(C,ab.position);g(C,P);v(C,F);w(C,Q)})};f.fn.sliderAttr=function(){var H=this.length?f(this[0]):f(this);var F=H.data("slider");if(!F){return}var I=arguments[0];var E=F.data();if(I==undefined){return{value:E.value,min:E.min,max:E.max,step:E.step,disabled:E.disabled,status:E.status_value}}if(typeof I=="object"){for(var B in I){H.sliderAttr(B,I[B])}return H}var B=I;if(typeof B!="string"){return}var G;var C="get";if(arguments[1]!=undefined){C="set";G=arguments[1];if(typeof G=="number"){G=parseInt(G)}}var D={value:{get:function(){return E.value},set:function(){if(x){return}var K=p(G,E.min,E.max,E.step,E.slider_width);n(F,K.position);g(F,G)}},min:{get:function(){return E.min},set:function(){var K=p(E.value,G,E.max,E.step,E.slider_width);F.data({min:G,step_width:K.step_width});n(F,K.position)}},max:{get:function(){return E.max},set:function(){var K=p(E.value,E.min,G,E.step,E.slider_width);F.data({max:G,step_width:K.step_width});n(F,K.position)}},step:{get:function(){return E.step},set:function(){var K=p(E.value,E.min,E.max,G,E.slider_width);F.data({step:G,step_width:K.step_width})}},disabled:{get:function(){return E.disabled},set:function(){v(F,G)}},status:{get:function(){return E.status_value},set:function(){w(F,G)}}};if(D[B]==undefined){return}var J=D[B][C]();return C=="get"?J:H};f.fn.sliderMove=function(){var C=this.length?f(this[0]):f(this);var E=C.data("slider");if(!E){return}var B=arguments[0];if(B==undefined){return}var D=E.data();var F={up:function(){A(E,1)},down:function(){A(E,-1)},min:function(){c(E,D.min)},max:function(){c(E,D.max)}};if(F[B]==undefined){return}F[B]();return C}})(jQuery);